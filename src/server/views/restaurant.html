{% extends "_base.html" %}

{% block title %}{% endblock %}

{% block content %}
  <div class="restaurants">
    <div class="row">
      <div class="col-xs-offset-4 col-xs-4">
        <h2>{{reviews.length}} Review{% if reviews.length != 1 %}s{% endif %}
        </h2>
      </div>
      {% if admin == false %}
      <div class="col-xs-4">
        <h3>
          <form  action="/restaurants/{{restaurants[0].id}}/reviews/new" method="get">
            <input type="hidden" name="id" value="{{restaurants[0].id}}">
            <input type="hidden" name="name" value="{{restaurants[0].name}}">
            <input class="submitLink" type="submit" name="submit" value="Add Review">
          </form>
        </h3>
      </div>
      {% endif %}
    </div>

    {%for restaurant in restaurants%}
    <div class="restaurantDiv col-xs-4">
      <h1>{{restaurant.restaurant_name}}</h1>
      <img class="restImg"src="{{restaurant.images}}" alt="image"/>
      <h3>Cuisine: {{restaurant.style}}</h3>
      <h4>{{restaurant.location}}</h4>
      <h4>{{restaurant.rating}}</h4>
      <!-- Success Pop Up -->
      <div class="bs-example" id="mySuccess" style="display:none">
        <div class="alert alert-success fade in">
          <a href="#" class="close" data-dismiss="alert">&times;</a>
          <strong>Success!</strong> Your restaurant has been deleted successfully.
        </div>
      </div>
      <!-- Close Success Pop Up -->
      <form action="/restaurants/update/{{restaurant.id}}"><input type="submit" class="submitLink" value="Update" /></form>
      <form id="deleteForm"><input type="hidden" id="restID" value="{{restaurant.id}}" name="restID" /> <input type="submit" class="submitLink" value="Delete" /></form>
      </div>
    </div>
    {%endfor%}

    <div class="reviewsDiv col-xs-8">
    {% if user_id == review.id%}
    {% for review in reviews%}
    <h2>{{review.date}}</h2>
    <h4>{{review.rating}}</h4>
    <p>{{review.text}}<p>
    <p>{{review.first_name}} {{review.last_name}}</p>

    <div class="">
      <h3>
        <form  action="/restaurants/{{restaurants[0].id}}/reviews/edit" method="post">
          <input type="hidden" name="id" value="{{restaurants[0].id}}">
          <input type="hidden" name="name" value="{{restaurants[0].name}}">
          <input class="submitLink" type="submit" name="submit" value="Edit Review">
        </form>
      </h3>
    </div>
    {% endfor%}
    {% endif %}
  </div>
  <script>
  $(document).on('submit', '#deleteForm', function(event) {
    event.preventDefault();
    const id = $('#restID').val();
    $.ajax({
      type: 'DELETE',
      url: `/restaurants/delete/${id}`
    })
    .done((data) => {
      $('#mySuccess').toggle();
      setTimeout(function() {
        window.location.href = "../../restaurants";
      }, 1000);
      console.log(data);
    })
    .fail((err) => {
      console.log(err);
    });
  });

  </script>

{% endblock %}
